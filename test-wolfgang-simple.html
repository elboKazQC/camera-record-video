<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Cam√©ra Wolfgang - Simple</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #282c34;
            color: white;
            padding: 20px;
            margin: 0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            color: #61dafb;
            text-align: center;
        }
        
        .section {
            background-color: #3a3f47;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #61dafb;
        }
        
        button {
            background-color: #61dafb;
            color: #282c34;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        
        button:hover {
            background-color: #21a9c7;
        }
        
        .error {
            background-color: #ff4444;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .success {
            background-color: #4CAF50;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .device-list {
            list-style: none;
            padding: 0;
        }
        
        .device-item {
            background-color: #4a4f57;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        video {
            max-width: 100%;
            height: auto;
            border: 2px solid #61dafb;
            border-radius: 8px;
            background-color: #000;
        }
        
        #videoContainer {
            text-align: center;
            margin: 20px 0;
        }
        
        .info {
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #ccc;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé• Test Diagnostic Cam√©ra Wolfgang</h1>
        
        <div class="section">
            <h2>√âtape 1: V√©rifications Pr√©liminaires</h2>
            <div id="browserSupport"></div>
            <button onclick="checkBrowserSupport()">üîç V√©rifier le Support Navigateur</button>
        </div>
        
        <div class="section">
            <h2>√âtape 2: D√©tection des P√©riph√©riques</h2>
            <div id="devicesList"></div>
            <button onclick="scanDevices()">üîÑ Scanner les Cam√©ras</button>
            <button onclick="requestPermissions()">üîì Demander Permissions</button>
        </div>
        
        <div class="section">
            <h2>√âtape 3: Test Vid√©o</h2>
            <div id="videoContainer">
                <video id="videoPreview" autoplay playsinline muted></video>
            </div>
            <div id="videoControls">
                <button onclick="startVideo()">‚ñ∂Ô∏è D√©marrer Vid√©o</button>
                <button onclick="stopVideo()">‚èπÔ∏è Arr√™ter Vid√©o</button>
                <button onclick="testAllCameras()">üéØ Tester Toutes les Cam√©ras</button>
            </div>
        </div>
        
        <div class="section">
            <h2>√âtape 4: Informations D√©taill√©es</h2>
            <div id="detailedInfo"></div>
            <button onclick="getDetailedInfo()">üìä Infos D√©taill√©es</button>
        </div>
    </div>

    <script>
        let currentStream = null;
        let allDevices = [];
        
        // V√©rifier le support du navigateur
        function checkBrowserSupport() {
            const supportDiv = document.getElementById('browserSupport');
            let html = '<h3>Support Navigateur:</h3>';
            
            if (!navigator.mediaDevices) {
                html += '<div class="error">‚ùå MediaDevices API non support√©</div>';
            } else {
                html += '<div class="success">‚úÖ MediaDevices API support√©</div>';
            }
            
            if (!navigator.mediaDevices.getUserMedia) {
                html += '<div class="error">‚ùå getUserMedia non support√©</div>';
            } else {
                html += '<div class="success">‚úÖ getUserMedia support√©</div>';
            }
            
            if (!navigator.mediaDevices.enumerateDevices) {
                html += '<div class="error">‚ùå enumerateDevices non support√©</div>';
            } else {
                html += '<div class="success">‚úÖ enumerateDevices support√©</div>';
            }
            
            html += `<div class="info">
                Navigateur: ${navigator.userAgent}<br>
                Protocole: ${location.protocol}<br>
                ${location.protocol === 'https:' || location.hostname === 'localhost' ? '‚úÖ' : '‚ùå'} Contexte s√©curis√© requis
            </div>`;
            
            supportDiv.innerHTML = html;
        }
        
        // Demander les permissions explicitement
        async function requestPermissions() {
            const devicesList = document.getElementById('devicesList');
            
            try {
                devicesList.innerHTML = '<div>üîÑ Demande de permissions...</div>';
                
                // Demander l'acc√®s √† la cam√©ra et au microphone
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: true, 
                    audio: true 
                });
                
                // Arr√™ter imm√©diatement le stream
                stream.getTracks().forEach(track => track.stop());
                
                devicesList.innerHTML = '<div class="success">‚úÖ Permissions accord√©es! Vous pouvez maintenant scanner les p√©riph√©riques.</div>';
                
                // Scanner automatiquement apr√®s avoir obtenu les permissions
                setTimeout(scanDevices, 1000);
                
            } catch (error) {
                console.error('Erreur permissions:', error);
                devicesList.innerHTML = `<div class="error">‚ùå Erreur permissions: ${error.message}</div>`;
            }
        }
        
        // Scanner les p√©riph√©riques disponibles
        async function scanDevices() {
            const devicesList = document.getElementById('devicesList');
            
            try {
                devicesList.innerHTML = '<div>üîÑ Scan des p√©riph√©riques...</div>';
                
                const devices = await navigator.mediaDevices.enumerateDevices();
                const videoDevices = devices.filter(device => device.kind === 'videoinput');
                
                console.log('Tous les p√©riph√©riques:', devices);
                console.log('P√©riph√©riques vid√©o:', videoDevices);
                
                allDevices = videoDevices;
                
                let html = `<h3>P√©riph√©riques Vid√©o D√©tect√©s: ${videoDevices.length}</h3>`;
                
                if (videoDevices.length === 0) {
                    html += '<div class="error">‚ùå Aucune cam√©ra d√©tect√©e</div>';
                    html += '<div class="info">Possible causes:<br>- Wolfgang n\'est pas en mode webcam<br>- Pilotes manquants<br>- C√¢ble USB d√©fectueux<br>- Port USB d√©faillant</div>';
                } else {
                    html += '<ul class="device-list">';
                    videoDevices.forEach((device, index) => {
                        const isWolfgang = device.label.toLowerCase().includes('wolfgang') || 
                                         device.label.toLowerCase().includes('wolfang');
                        const deviceName = device.label || `Cam√©ra ${index + 1}`;
                        
                        html += `
                            <li class="device-item ${isWolfgang ? 'wolfgang-detected' : ''}">
                                <div>
                                    <strong>${isWolfgang ? 'üéØ WOLFGANG: ' : 'üìπ '}${deviceName}</strong><br>
                                    <span class="info">ID: ${device.deviceId}</span>
                                </div>
                                <div>
                                    <button onclick="testDevice('${device.deviceId}')">Tester</button>
                                    <button onclick="getDeviceCapabilities('${device.deviceId}')">Capacit√©s</button>
                                </div>
                            </li>
                        `;
                    });
                    html += '</ul>';
                    
                    // V√©rifier si Wolfgang est d√©tect√©
                    const wolfangFound = videoDevices.some(device => 
                        device.label.toLowerCase().includes('wolfgang') || 
                        device.label.toLowerCase().includes('wolfang')
                    );
                    
                    if (wolfangFound) {
                        html += '<div class="success">üéâ WOLFGANG D√âTECT√â!</div>';
                    } else {
                        html += '<div class="error">‚ö†Ô∏è Wolfgang non trouv√© dans la liste</div>';
                    }
                }
                
                devicesList.innerHTML = html;
                
            } catch (error) {
                console.error('Erreur scan:', error);
                devicesList.innerHTML = `<div class="error">‚ùå Erreur scan: ${error.message}</div>`;
            }
        }
        
        // Tester une cam√©ra sp√©cifique
        async function testDevice(deviceId) {
            try {
                await startVideoWithDevice(deviceId);
            } catch (error) {
                console.error('Erreur test:', error);
                alert(`Erreur lors du test de la cam√©ra: ${error.message}`);
            }
        }
        
        // D√©marrer la vid√©o avec un p√©riph√©rique sp√©cifique
        async function startVideoWithDevice(deviceId) {
            const video = document.getElementById('videoPreview');
            
            try {
                // Arr√™ter le stream existant
                if (currentStream) {
                    currentStream.getTracks().forEach(track => track.stop());
                }
                
                const constraints = {
                    video: {
                        deviceId: deviceId ? { exact: deviceId } : undefined,
                        width: { ideal: 1920 },
                        height: { ideal: 1080 }
                    },
                    audio: false
                };
                
                console.log('Contraintes vid√©o:', constraints);
                
                currentStream = await navigator.mediaDevices.getUserMedia(constraints);
                video.srcObject = currentStream;
                
                // Afficher les informations du stream
                const track = currentStream.getVideoTracks()[0];
                const settings = track.getSettings();
                console.log('Param√®tres de la cam√©ra:', settings);
                
                alert(`‚úÖ Cam√©ra d√©marr√©e!\nR√©solution: ${settings.width}x${settings.height}\nFPS: ${settings.frameRate}`);
                
            } catch (error) {
                console.error('Erreur d√©marrage vid√©o:', error);
                throw error;
            }
        }
        
        // D√©marrer la vid√©o (premi√®re cam√©ra disponible)
        async function startVideo() {
            if (allDevices.length > 0) {
                await startVideoWithDevice(allDevices[0].deviceId);
            } else {
                alert('Aucune cam√©ra disponible. Scannez d\'abord les p√©riph√©riques.');
            }
        }
        
        // Arr√™ter la vid√©o
        function stopVideo() {
            const video = document.getElementById('videoPreview');
            
            if (currentStream) {
                currentStream.getTracks().forEach(track => track.stop());
                currentStream = null;
                video.srcObject = null;
            }
        }
        
        // Tester toutes les cam√©ras une par une
        async function testAllCameras() {
            for (let i = 0; i < allDevices.length; i++) {
                const device = allDevices[i];
                const proceed = confirm(`Tester ${device.label || 'Cam√©ra ' + (i+1)} ?`);
                
                if (proceed) {
                    try {
                        await startVideoWithDevice(device.deviceId);
                        await new Promise(resolve => setTimeout(resolve, 3000)); // Attendre 3 secondes
                    } catch (error) {
                        alert(`Erreur avec ${device.label}: ${error.message}`);
                    }
                }
            }
        }
        
        // Obtenir les capacit√©s d'un p√©riph√©rique
        async function getDeviceCapabilities(deviceId) {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { deviceId: { exact: deviceId } }
                });
                
                const track = stream.getVideoTracks()[0];
                const capabilities = track.getCapabilities();
                const settings = track.getSettings();
                
                console.log('Capacit√©s:', capabilities);
                console.log('Param√®tres:', settings);
                
                let info = 'Capacit√©s de la cam√©ra:\n\n';
                info += `R√©solutions support√©es: ${capabilities.width?.min}-${capabilities.width?.max} x ${capabilities.height?.min}-${capabilities.height?.max}\n`;
                info += `FPS: ${capabilities.frameRate?.min}-${capabilities.frameRate?.max}\n`;
                info += `Zoom: ${capabilities.zoom ? 'Oui' : 'Non'}\n`;
                info += `Focus: ${capabilities.focusMode ? 'Oui' : 'Non'}\n`;
                
                alert(info);
                
                // Nettoyer
                stream.getTracks().forEach(track => track.stop());
                
            } catch (error) {
                alert(`Erreur lors de l'obtention des capacit√©s: ${error.message}`);
            }
        }
        
        // Obtenir des informations d√©taill√©es
        function getDetailedInfo() {
            const detailedDiv = document.getElementById('detailedInfo');
            
            let html = '<h3>Informations Syst√®me:</h3>';
            html += `<div class="info">`;
            html += `Navigateur: ${navigator.userAgent}<br>`;
            html += `Plateforme: ${navigator.platform}<br>`;
            html += `Langue: ${navigator.language}<br>`;
            html += `Cookies activ√©s: ${navigator.cookieEnabled}<br>`;
            html += `Connexion r√©seau: ${navigator.onLine ? 'En ligne' : 'Hors ligne'}<br>`;
            html += `Protocole: ${location.protocol}<br>`;
            html += `Host: ${location.host}<br>`;
            html += `√âcran: ${screen.width}x${screen.height}<br>`;
            html += `Fuseau horaire: ${Intl.DateTimeFormat().resolvedOptions().timeZone}<br>`;
            html += `</div>`;
            
            detailedDiv.innerHTML = html;
        }
        
        // Initialisation
        window.addEventListener('load', () => {
            checkBrowserSupport();
            
            // Message d'aide
            console.log(`
=== DIAGNOSTIC WOLFGANG ===
1. Cliquez sur "V√©rifier le Support Navigateur"
2. Cliquez sur "Demander Permissions" 
3. Autorisez l'acc√®s √† la cam√©ra
4. Cliquez sur "Scanner les Cam√©ras"
5. Si Wolfgang appara√Æt, cliquez sur "Tester"

En cas de probl√®me:
- V√©rifiez que Wolfgang est allum√© et en mode webcam
- Testez un autre c√¢ble/port USB  
- Red√©marrez Wolfgang
- V√©rifiez dans le gestionnaire de p√©riph√©riques Windows
            `);
        });
    </script>
</body>
</html>